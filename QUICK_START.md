# 快速启动指南

**日期**: 2025-11-10  
**状态**: ✅ 开发服务器已启动

---

## 🚀 开发服务器已启动

访问: **http://localhost:3000**

---

## 📋 端到端测试步骤

### 准备工作

1. **准备 3 个钱包**:
   - 买家钱包（用于发布需求和创建 Escrow）
   - 提供商钱包（用于提交提案和标记交付）
   - 平台钱包（已配置，用于解决争议）

2. **准备测试资金**:
   - 每个钱包至少 0.5 SOL（交易费用）
   - 买家钱包至少 10 USDC（测试支付）

3. **切换到 Solana Devnet**:
   - 在 Phantom/Solflare 钱包中切换到 Devnet

---

## 🧪 测试场景 1: 完整成功流程

### 步骤 1: 买家发布需求

1. 访问 http://localhost:3000
2. 连接买家钱包
3. 点击导航栏的 "Marketplace"
4. 点击 "Create Request" 或访问 `/marketplace/requests/new`
5. 填写需求信息:
   ```
   标题: 测试需求 - BTC 交易数据
   描述: 需要 2024 年完整的 BTC 交易数据
   预算: 10 USDC
   截止日期: 2025-11-20
   ```
6. 点击 "发布需求"
7. ✅ **验证**: 需求出现在列表中

### 步骤 2: 提供商提交提案

1. 断开买家钱包
2. 连接提供商钱包
3. 访问 `/marketplace/requests`
4. 点击刚才创建的需求
5. 点击 "提交提案"
6. 填写提案信息:
   ```
   描述: 我有完整的 2024 年 BTC 数据，包含价格、交易量等
   报价: 8 USDC
   交付时间: 3 天
   ```
7. 提交提案
8. ✅ **验证**: 提案出现在需求详情页面

### 步骤 3: 买家接受提案（创建 Escrow）

1. 断开提供商钱包
2. 连接买家钱包
3. 刷新需求详情页面
4. 找到提供商的提案
5. 点击 **"创建智能合约托管"** 按钮
6. 阅读 Escrow 说明
7. 确认钱包交易（需要签名 2 次）
8. 等待交易确认（约 10-30 秒）
9. ✅ **验证**:
   - 显示成功消息
   - 显示 Escrow PDA 和交易签名
   - 自动跳转到 `/escrow` 页面
   - Escrow 出现在列表中，状态为 "已充值"
   - 提案状态变为 "已接受"
   - 需求状态变为 "进行中"

### 步骤 4: 提供商标记交付

1. 断开买家钱包
2. 连接提供商钱包
3. 访问 `/escrow` 页面
4. 找到对应的 Escrow（显示 "提供商" 标签）
5. 点击 **"标记交付"** 按钮
6. 确认钱包交易
7. 等待交易确认
8. ✅ **验证**:
   - Escrow 状态变为 "已交付"
   - 买家可以看到 "确认并释放资金" 和 "发起争议" 按钮

### 步骤 5: 买家确认并释放资金

1. 断开提供商钱包
2. 连接买家钱包
3. 刷新 `/escrow` 页面
4. 找到对应的 Escrow
5. 点击 **"确认并释放资金 (95/5)"** 按钮
6. 确认对话框
7. 确认钱包交易
8. 等待交易确认
9. ✅ **验证**:
   - Escrow 状态变为 "已完成"
   - 提供商收到 7.6 USDC (95%)
   - 平台收到 0.4 USDC (5%)
   - 可以在 Solana Explorer 查看交易详情

---

## 🧪 测试场景 2: 取消订单

### 步骤 1-3: 同场景 1（创建 Escrow）

### 步骤 4: 买家取消订单（交付前）

1. 连接买家钱包
2. 访问 `/escrow` 页面
3. 找到状态为 "已充值" 的 Escrow
4. 点击 **"取消订单（全额退款）"** 按钮
5. 确认对话框
6. 确认钱包交易
7. 等待交易确认
8. ✅ **验证**:
   - Escrow 状态变为 "已取消"
   - 买家收到全额退款 (8 USDC)
   - 提供商收到 0 USDC

---

## 🧪 测试场景 3: 争议解决（退款）

### 步骤 1-4: 同场景 1（到标记交付）

### 步骤 5: 买家发起争议

1. 连接买家钱包
2. 访问 `/escrow` 页面
3. 找到状态为 "已交付" 的 Escrow
4. 点击 **"发起争议"** 按钮
5. 确认对话框
6. 确认钱包交易
7. 等待交易确认
8. ✅ **验证**:
   - Escrow 状态变为 "争议中"
   - 平台可以看到解决争议选项

### 步骤 6: 平台仲裁（退款给买家）

1. 断开买家钱包
2. 连接平台钱包（使用 `platform-wallet.json`）
3. 访问 `/escrow` 页面
4. 找到争议中的 Escrow
5. 点击 **"退款给买家"** 按钮
6. 确认对话框
7. 确认钱包交易
8. 等待交易确认
9. ✅ **验证**:
   - Escrow 状态变为 "已退款"
   - 买家收到全额退款 (8 USDC)
   - 提供商收到 0 USDC

---

## 🧪 测试场景 4: 争议解决（释放）

### 步骤 1-5: 同场景 3（到发起争议）

### 步骤 6: 平台仲裁（释放给提供商）

1. 连接平台钱包
2. 访问 `/escrow` 页面
3. 找到争议中的 Escrow
4. 点击 **"释放给提供商 (95/5)"** 按钮
5. 确认对话框
6. 确认钱包交易
7. 等待交易确认
8. ✅ **验证**:
   - Escrow 状态变为 "已完成"
   - 提供商收到 7.6 USDC (95%)
   - 平台收到 0.4 USDC (5%)
   - 买家收到 0 USDC

---

## 📊 测试结果记录

### 场景 1: 完整成功流程
- [ ] 发布需求成功
- [ ] 提交提案成功
- [ ] 创建 Escrow 成功
- [ ] 标记交付成功
- [ ] 确认释放成功
- [ ] 资金分配正确 (95/5)
- **交易签名**: _______________

### 场景 2: 取消订单
- [ ] 创建 Escrow 成功
- [ ] 取消订单成功
- [ ] 全额退款成功
- **交易签名**: _______________

### 场景 3: 争议解决（退款）
- [ ] 创建 Escrow 成功
- [ ] 标记交付成功
- [ ] 发起争议成功
- [ ] 平台仲裁成功
- [ ] 退款成功
- **交易签名**: _______________

### 场景 4: 争议解决（释放）
- [ ] 创建 Escrow 成功
- [ ] 标记交付成功
- [ ] 发起争议成功
- [ ] 平台仲裁成功
- [ ] 释放成功 (95/5)
- **交易签名**: _______________

---

## 🔍 验证工具

### Solana Explorer
访问: https://explorer.solana.com/?cluster=devnet

查看:
- 交易详情
- Escrow PDA 账户
- Token 转账记录
- Program 日志

### 数据库查询
```bash
# 查看 Escrow 记录
npx prisma studio

# 或使用 SQL
psql -d datanexus -c "SELECT * FROM \"Escrow\" ORDER BY \"createdAt\" DESC LIMIT 10;"
```

---

## 🐛 常见问题

### 问题 1: 钱包连接失败
**解决方案**:
- 确保已安装 Phantom 或 Solflare 钱包
- 刷新页面重试
- 检查钱包是否切换到 Devnet

### 问题 2: 交易失败 "insufficient funds"
**解决方案**:
- 检查 SOL 余额（至少 0.5 SOL）
- 检查 USDC 余额（买家至少 10 USDC）
- 访问 https://faucet.solana.com 获取测试 SOL

### 问题 3: Escrow 未显示
**解决方案**:
- 点击 "刷新列表" 按钮
- 检查钱包地址是否正确
- 检查过滤器设置
- 查看浏览器控制台错误

### 问题 4: 按钮不显示
**解决方案**:
- 确认钱包已连接
- 确认钱包地址与角色匹配
- 确认 Escrow 状态正确
- 刷新页面

---

## 📝 下一步

测试完成后:

1. ✅ 记录所有测试结果
2. ✅ 截图关键步骤
3. ✅ 录制演示视频
4. ✅ 准备 Hackathon 演示材料
5. ✅ 准备评委问答

---

## 🎯 重要链接

- **本地应用**: http://localhost:3000
- **Escrow 页面**: http://localhost:3000/escrow
- **需求市场**: http://localhost:3000/marketplace/requests
- **Solana Explorer**: https://explorer.solana.com/?cluster=devnet
- **Program ID**: `gxDTeSCzk9mqiokrmTb1uNbWCjQ1rj2hsj5N65K9698`

---

**测试人员**: _____________  
**测试日期**: _____________  
**测试状态**: ⏳ 进行中

🚀 **开始测试吧！**

